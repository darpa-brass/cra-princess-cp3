// NOTE: maybe not easy to synthesize~


// Macro definition to get pointer to arch-specific dispatcher
//
// Logical equivalent of C function with same name
//
; .macro get_dispatcher_shared_arm out tmp
;    	// load_got \tmp
;     // -> mrc     p15, 0, r0, c13, c0, 4
;     ldr      \out, dcb_current_idx
;     ldr      \out, [\tmp, \out]
;     ldr      \out, [\out]        // out = dcb_current
;     ldr      \out, [\out, #OFFSETOF_DCB_DISP] //now ptr to dispatcher_shared_arm
; .endm

// get_dispatcher_shared_arm r2 r0

// mrc     p15, 0, r0, c13, c0, 4
ldr      r2, dcb_current_idx
ldr      r2, [r0, r2]
ldr      r2, [r2]        // out = dcb_current
ldr      r2, [r2, #OFFSETOF_DCB_DISP] //now ptr to dispatcher_shared_arm


// 
// /* The GOT offset of dcb_current. */
//     .type dcb_current_idx, STT_OBJECT
// dcb_current_idx:
//     .word dcb_current(GOT)
//
// OFFSETOF_DCB_DISP -> generated by asmoffset.c
